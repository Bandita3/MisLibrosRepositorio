/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.mycompany.mislibros.igu;

import com.mycompany.mislibros.modelo.Autor;
import com.mycompany.mislibros.logica.Controladora;
import com.mycompany.mislibros.logica.LogicaBuscarAutoresDeLibro;
import com.mycompany.mislibros.modelo.Libro;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Martín_Guerra
 */
public class Principal extends javax.swing.JFrame {

    Controladora control;

    public Principal() {
        initComponents();
        //Cuando se abre la interfaz gráfica, se crea una instancia a la lógica.
        control = new Controladora();
        mostrarListaLibros();
        agregarTooltipALaTabla();
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollBar1 = new javax.swing.JScrollBar();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        btnIngresarLibro = new javax.swing.JButton();
        btnEliminarActor = new javax.swing.JButton();
        btnVerLibros = new javax.swing.JButton();
        btnSalir = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        tablaLibros = new javax.swing.JTable();
        btnEliminar = new javax.swing.JButton();
        lblFondo = new javax.swing.JLabel();
        btnIngresarActor1 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel2.setFont(new java.awt.Font("Elephant", 0, 36)); // NOI18N
        jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/libro (1) (1).png"))); // NOI18N
        jLabel2.setText("Mi lista de libros");

        btnIngresarLibro.setText("Ingresar libro");
        btnIngresarLibro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIngresarLibroActionPerformed(evt);
            }
        });

        btnEliminarActor.setText("Eliminar autor");
        btnEliminarActor.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActorActionPerformed(evt);
            }
        });

        btnVerLibros.setFont(new java.awt.Font("Dialog", 0, 10)); // NOI18N
        btnVerLibros.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/recargarbtn (1) (1).png"))); // NOI18N
        btnVerLibros.setText("Actualizar");
        btnVerLibros.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVerLibrosActionPerformed(evt);
            }
        });

        btnSalir.setFont(new java.awt.Font("Dialog", 0, 14)); // NOI18N
        btnSalir.setText("Salir");
        btnSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSalirActionPerformed(evt);
            }
        });

        tablaLibros.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "ID", "Titulo", "Clasificacion", "Numero"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Integer.class, java.lang.String.class, java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane3.setViewportView(tablaLibros);

        btnEliminar.setText("Eliminar libro seleccionado");
        btnEliminar.setMaximumSize(new java.awt.Dimension(100, 23));
        btnEliminar.setMinimumSize(new java.awt.Dimension(100, 23));
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });

        btnIngresarActor1.setText("Ingresar autor");
        btnIngresarActor1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnIngresarActor1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(99, 99, 99)
                        .addComponent(jLabel2)
                        .addGap(4, 4, 4)
                        .addComponent(btnVerLibros))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(btnIngresarActor1, javax.swing.GroupLayout.PREFERRED_SIZE, 193, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(107, 107, 107)
                        .addComponent(btnIngresarLibro, javax.swing.GroupLayout.PREFERRED_SIZE, 193, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(btnEliminarActor, javax.swing.GroupLayout.PREFERRED_SIZE, 193, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(107, 107, 107)
                        .addComponent(btnEliminar, javax.swing.GroupLayout.PREFERRED_SIZE, 192, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(28, 28, 28)
                        .addComponent(lblFondo, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(btnSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 83, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 515, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel2)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(27, 27, 27)
                        .addComponent(btnVerLibros)))
                .addGap(7, 7, 7)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 99, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(12, 12, 12)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btnIngresarActor1, javax.swing.GroupLayout.DEFAULT_SIZE, 35, Short.MAX_VALUE)
                    .addComponent(btnIngresarLibro, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(15, 15, 15)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblFondo, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(btnEliminarActor, javax.swing.GroupLayout.DEFAULT_SIZE, 35, Short.MAX_VALUE)
                            .addComponent(btnEliminar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 84, Short.MAX_VALUE)
                .addComponent(btnSalir)
                .addGap(16, 16, 16))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 550, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
   
    private void btnEliminarActorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActorActionPerformed
        
    }//GEN-LAST:event_btnEliminarActorActionPerformed

    private void btnIngresarLibroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIngresarLibroActionPerformed
        ventanaIngresarLibro ventIngLib = new ventanaIngresarLibro(control);
        ventIngLib.setVisible(true);
        ventIngLib.setLocationRelativeTo(null);
    }//GEN-LAST:event_btnIngresarLibroActionPerformed

    private void btnVerLibrosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVerLibrosActionPerformed
        mostrarListaLibros();
    }//GEN-LAST:event_btnVerLibrosActionPerformed

    private void btnSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSalirActionPerformed
        System.out.println("Cerrando programa....."); 
        System.exit(0); //cierra la aplicación
    }//GEN-LAST:event_btnSalirActionPerformed

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActionPerformed
        int filaSeleccionada = tablaLibros.getSelectedRow();
        
        if (filaSeleccionada >=0){
            
            int idLibro = (int) tablaLibros.getValueAt(filaSeleccionada, 0);
            
            int confirmarcion = JOptionPane.showConfirmDialog(this, "Va a eliminar el libro con id: " +idLibro + " ¿Esta seguro?", "Confirmar Eliminacion", JOptionPane.YES_NO_OPTION) ;
            
            if (confirmarcion == JOptionPane.YES_OPTION){
                control.eliminarLibro(idLibro);
                
                mostrarListaLibros();
                JOptionPane.showMessageDialog(this, "Libro eliminado correctamente");    
            } else {
                JOptionPane.showMessageDialog(this, "Debe seleccionar un libro para eliminar", "error", JOptionPane.ERROR_MESSAGE);
            }
            
        }
    }//GEN-LAST:event_btnEliminarActionPerformed

    private void btnIngresarActor1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnIngresarActor1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_btnIngresarActor1ActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnEliminar;
    private javax.swing.JButton btnEliminarActor;
    private javax.swing.JButton btnIngresarActor1;
    private javax.swing.JButton btnIngresarLibro;
    private javax.swing.JButton btnSalir;
    private javax.swing.JButton btnVerLibros;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollBar jScrollBar1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JLabel lblFondo;
    private javax.swing.JTable tablaLibros;
    // End of variables declaration//GEN-END:variables
    
    public void mostrarListaLibros(){
        DefaultTableModel modelo = (DefaultTableModel) tablaLibros.getModel();
        modelo.setRowCount(0);
        
        //Traigo la lista de libros de mi base de datos
        ArrayList<Libro> listaLibros = control.traerListaLibros();
        for (Libro libro : listaLibros) {
        modelo.addRow(new Object[]{
            libro.getId(),
            libro.getTitulo(),
            libro.getClasificacion(),
            libro.getNumero(),
            libro.obtenerCreadores()
        });
    }
    }
    //Este metodo muestra el autor al arrastrar el mouse sobre un libro
    private void agregarTooltipALaTabla(){
        tablaLibros.addMouseMotionListener(new java.awt.event.MouseMotionAdapter(){
            @Override
            public void mouseMoved(java.awt.event.MouseEvent e){
            //Obtenemos la fila donde esta parado el mouse
            int fila = tablaLibros.rowAtPoint(e.getPoint());
            //Obtenemos la columna donde esta parado el mouse
            int columna = tablaLibros.columnAtPoint(e.getPoint());
            
            /*Verificamos si el mouse esta parado sobre un libro, de ser asi muestra un cuadro con el autor,
            Si no hay ningun libro, no muestra nada (Sin esto se mostraria la informacion fuera de la tabla)
            
            */
            if (fila > -1 && columna >1) {
                
                //Obtenemos el id que esta ubicado en la columna 0
                int idLibro = (int) tablaLibros.getValueAt(fila, 0); 
                
                //Traemos el objeto libro desde su id
                Libro libro = control.traerLibro(idLibro);
                
                //Si el libro existe, se mostrara su autor
                if(libro != null) {
                    //Usamos html para hacer un salto de linea a la hora de mostrar los autores(En caso de que haya mas de un autor)
                    tablaLibros.setToolTipText("<html><b> Autor:" + libro.obtenerCreadores());
                
                //Si no existe, no se mostrara nada
                } else {
                    tablaLibros.setToolTipText(null);
                }
                
            }
            
            
        }
        
        
    });
    
}
    
}
